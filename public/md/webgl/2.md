# webgl绘制渐变三角形

所有者: Stan

1. 渐变三角形是利用顶点颜色插值。
2. GPU会自动对齐顶点属性，进行线性插值，以生成每个片元所需要的数据。
3. GPU在光栅化的过程中，会计算每个片元相对于三个顶点的重心，进行线性加权计算

```glsl
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0"
        />
        <title>Document</title>
    </head>
    <body>
        <canvas
            id="webgl-canvas"
            width="400"
            height="400"
        ></canvas>

        <script>
            const canvas = document.getElementById("webgl-canvas");
            const gl = canvas.getContext("webgl");

			// 顶点颜色插值
			// GPU会自动对齐顶点属性，进行线性插值，以生成每个片元所需要的数据
            const vertexShaderSource = `
                    	attribute vec4 a_Position;
						attribute vec4 a_Color;
						varying vec4 v_Color;
                    	void main(){
                    		gl_Position = a_Position;
                    		v_Color = a_Color;
                    	}
                    `;

            const fragmentShaderSource = `
						precision mediump float;
                    	varying vec4 v_Color;
                    	void main(){
                    		gl_FragColor = v_Color;
                    	}
                    `;

            function createShader(gl, type, source) {
                const shader = gl.createShader(type);
                gl.shaderSource(shader, source);
                gl.compileShader(shader);

                return shader;
            }

            const vertexShader = createShader(
                gl,
                gl.VERTEX_SHADER,
                vertexShaderSource
            );

            const fragmentShader = createShader(
                gl,
                gl.FRAGMENT_SHADER,
                fragmentShaderSource
            );

            // 创建程序对象
            const program = gl.createProgram();
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);
            gl.useProgram(program);

            // 获取 attribute 变量的存储位置
            const a_Position = gl.getAttribLocation(program, "a_Position");

            gl.clearColor(1.0, 1.0, 1.0, 1.0);
            gl.clear(gl.COLOR_BUFFER_BIT);

            // 三角形顶点
            // GPU只识别二进制数据
            // Float32Array 连续的32位浮点数，上传到buffer中不需要额外的转换，正好影射到显卡内存
            const points = new Float32Array([
                // 每个顶点：x, y, r, g, b
                0, 0.5, 0, 0, 1,

                -0.5, -0.5, 1, 0, 0,

                0.5, -0.5, 0, 1, 0,
            ]);
            const buffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
            gl.bufferData(gl.ARRAY_BUFFER, points, gl.STATIC_DRAW);

            // 位置属性
            // gl.vertexAttribPointer(index, size, type, normalized, stride, offset);
            // 5*4 指的是每个顶点占用的字节数
            gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 5 * 4, 0);
            gl.enableVertexAttribArray(a_Position);

            // 颜色属性
            const a_Color = gl.getAttribLocation(program, "a_Color");
            // 2 * 4 是颜色属性的偏移量，因为前面是位置属性
            gl.vertexAttribPointer(a_Color, 3, gl.FLOAT, false, 5 * 4, 2 * 4);
            gl.enableVertexAttribArray(a_Color);

            gl.drawArrays(gl.TRIANGLES, 0, 3);
        </script>
    </body>
</html>

```

![triangle.png](/public/md/webgl/image/triangle.png)