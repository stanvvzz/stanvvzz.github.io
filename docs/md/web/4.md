# createWebHashHistory和createWebHistory 有什么区别？

所有者: Stan

在 Vue Router 中，`createWebHashHistory` 和 `createWebHistory` 是两种创建前端路由历史记录的模式。它们最核心的区别在于 **URL 的表现形式**和**对服务器的要求**。

### 1. `createWebHashHistory` (Hash 模式)

`createWebHashHistory` 使用 URL 的 hash (哈希) 部分来进行路由。它的 URL 看起来是这样的：
`https://example.com/#/earth`

**运作原理：**

- URL 中 `#` (hash) 符号以及它后面的所有内容（例如 `/earth`）**都不会被发送到服务器**。
- 对服务器而言，无论你的 URL 怎么变化（例如从 `/#/earth` 变成 `/#/blog`），它收到的请求永远是针对根路径 `https://example.com/` 的。
- 服务器只需要返回根目录的 `index.html` 文件。
- 浏览器加载 `index.html` 后，Vue Router 会接管路由，读取 URL 中 `#` 后面的路径，然后在浏览器端（客户端）完成对应组件的渲染。

**优点：**

- **无需任何服务器端配置**：这是它最大的优点。因为服务器不需要处理任何子路径，所以你可以轻松地将应用部署到任何静态文件托管服务上，比如 GitHub Pages、Netlify 等。
- **兼容性好**：对旧版浏览器也有很好的支持。

---

### 2. `createWebHistory` (History 模式)

`createWebHistory` 利用了 HTML5 的 History API，可以创建出更美观、更“正常”的 URL，看起来就像传统的网站链接：
`https://example.com/earth`

**运作原理：**

- 它会直接修改浏览器的历史记录，URL 中没有 `#`。
- 当用户在应用内部通过 `<router-link>` 点击导航时，路由切换仍然在客户端进行，页面不会重新加载。
- **问题点**：当用户**直接在浏览器中输入 `https://example.com/earth`** 或者**在该页面上按 F5 刷新**时，浏览器会认为这是一个真实的 URL 地址，并向服务器发送一个对 `/earth` 路径的 GET 请求。

---

### 为什么 `createWebHistory` 在 GitHub Pages 上会失败？

现在我们就能理解为什么 `createWebHistory` 在 GitHub Pages 上行不通了。

GitHub Pages 是一个**静态文件托管服务**。这意味着它只会根据你请求的 URL 路径去寻找一个对应的文件。

当你使用 `createWebHistory` 模式并尝试访问 `https://your-username.github.io/your-repo/earth` 时，会发生以下情况：

1. 浏览器向 GitHub Pages 的服务器请求 `/your-repo/earth` 这个路径下的文件。
2. GitHub Pages 在你的项目中寻找一个名为 `earth` 的文件或文件夹。
3. 显然，你的项目中并没有这个文件（所有逻辑都在 `index.html` 和其引用的 JS 文件里）。
4. 因为找不到对应的资源，GitHub Pages 服务器只能返回一个 `404 Not Found` 错误页面。

而当你使用 `createWebHashHistory` 时，请求的 URL 是 `https://your-username.github.io/your-repo/#/earth`。浏览器只会向服务器请求 `#` 之前的部分，也就是 `https://your-username.github.io/your-repo/`。GitHub Pages 会正确地找到并返回你项目的 `index.html`。一旦 `index.html` 和 Vue 应用被加载，Vue Router 就会开始工作，读取 URL 中 `#` 后面的路径，并正确渲染出 `/earth` 路由对应的组件。

### 总结

| 特性 | `createWebHashHistory` (Hash 模式) | `createWebHistory` (History 模式) |
| --- | --- | --- |
| **URL 样式** | `https://example.com/#/user` (带 `#`) | `https://example.com/user` (干净 URL) |
| **工作模式** | 仅客户端路由，不向服务器发送子路径请求 | 客户端路由，但刷新或直接访问会向服务器请求 |
| **服务器配置** | **无需额外配置** | 需要服务器将所有子路径请求重定向到 `index.html` |
| **GitHub Pages 部署** | **可以直接运作** | **默认情况下会 404** |

**结论：**
对于像 GitHub Pages 这样的静态托管平台，`createWebHashHistory` 是最简单、最直接的解决方案。如果你非常希望使用 `createWebHistory` 的干净 URL，也不是没有办法，但需要一些额外的配置技巧（例如，使用一个特制的 `404.html` 页面来重定向所有请求到 `index.html`），这会增加部署的复杂性。