# WFS 服务

几个常见的请求

> GetCapabilities
> 

```tsx
const params = new URLSearchParams({
    service: "WFS",
    version,
    request: "GetCapabilities",
});
const capabilitiesUrl = `${baseUrl}?${params.toString()}`;

const nameElements = xmlDoc.querySelectorAll("FeatureType Name, wfs\\:FeatureType wfs\\:Name");
```

> DescribeFeatureType
> 

```tsx
const params = new URLSearchParams({
    service: "WFS",
    version,
    request: "DescribeFeatureType",
    typeName,
});

const describeUrl = `${baseUrl}?${params.toString()}`;

// xml
const text = await response.text();

const parser = new DOMParser();
const xmlDoc = parser.parseFromString(text, "text/xml");

const fields: WfsFieldInfo[] = [];
const elements = xmlDoc.querySelectorAll("element, xsd\\:element");

elements.forEach((element) => {
    const name = element.getAttribute("name");
    const type = element.getAttribute("type");

    if (name && type && name !== "geometry" && !name.toLowerCase().includes("shape")) {
        fields.push({
            name,
            type: type.replace(/^xsd:/, ""),
            // 是否允许是空值
            nullable: element.getAttribute("nillable") === "true",
        });
    }
});
```

> GetFeature
> 

注意：

1. geojson只有在2.0.0下有效，1.1.0版本会请求失败

```jsx
const params = new URLSearchParams({
    service: "WFS",
    version: "2.0.0",
    request: "GetFeature",
    typeName: actualTypeName,
    outputFormat: "geojson",
    maxFeatures: pageSize.toString(),    // 每页最大条数
    startIndex: ((page - 1) * pageSize).toString(), // 起始索引
});
```