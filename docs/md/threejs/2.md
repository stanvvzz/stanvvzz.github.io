# Three.js 光照系统详解

光照是 3D 渲染中最重要的概念之一，它决定了场景的真实感和氛围。本文将深入探讨 Three.js 中的各种光源类型。

## 光照基础

在 Three.js 中，光照计算基于物理光照模型，主要考虑以下因素：

-   **光源类型** - 不同类型的光源有不同的特性
-   **材质属性** - 物体表面如何反射光线
-   **几何法线** - 表面朝向影响光照计算

## 环境光 (AmbientLight)

环境光提供均匀的基础照明：

```javascript
// 创建环境光
const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
scene.add(ambientLight);

// 动态调整环境光
function updateAmbientLight() {
    const time = Date.now() * 0.001;
    ambientLight.intensity = 0.3 + Math.sin(time) * 0.2;
}
```

## 平行光 (DirectionalLight)

模拟太阳光等远距离光源：

```javascript
// 创建平行光
const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
directionalLight.position.set(5, 5, 5);
directionalLight.target.position.set(0, 0, 0);
scene.add(directionalLight);
scene.add(directionalLight.target);

// 启用阴影
directionalLight.castShadow = true;
directionalLight.shadow.mapSize.width = 2048;
directionalLight.shadow.mapSize.height = 2048;

// 设置阴影相机范围
directionalLight.shadow.camera.near = 0.5;
directionalLight.shadow.camera.far = 50;
directionalLight.shadow.camera.left = -10;
directionalLight.shadow.camera.right = 10;
directionalLight.shadow.camera.top = 10;
directionalLight.shadow.camera.bottom = -10;
```

## 点光源 (PointLight)

从一个点向所有方向发光：

```javascript
// 创建点光源
const pointLight = new THREE.PointLight(0xff0000, 1, 100);
pointLight.position.set(10, 10, 10);
scene.add(pointLight);

// 添加光源辅助器
const pointLightHelper = new THREE.PointLightHelper(pointLight, 1);
scene.add(pointLightHelper);

// 光源动画
function animatePointLight() {
    const time = Date.now() * 0.002;
    pointLight.position.x = Math.cos(time) * 20;
    pointLight.position.z = Math.sin(time) * 20;
}
```

## 聚光灯 (SpotLight)

锥形光束，常用于舞台效果：

```javascript
// 创建聚光灯
const spotLight = new THREE.SpotLight(0xffffff, 1);
spotLight.position.set(0, 20, 0);
spotLight.target.position.set(0, 0, 0);

// 设置聚光灯参数
spotLight.angle = Math.PI / 6; // 光锥角度
spotLight.penumbra = 0.1; // 边缘软化
spotLight.decay = 1; // 光衰减
spotLight.distance = 50; // 光照距离

// 启用阴影
spotLight.castShadow = true;
spotLight.shadow.mapSize.width = 1024;
spotLight.shadow.mapSize.height = 1024;

scene.add(spotLight);
scene.add(spotLight.target);

// 添加聚光灯辅助器
const spotLightHelper = new THREE.SpotLightHelper(spotLight);
scene.add(spotLightHelper);
```

## 材质与光照的交互

不同材质对光照的响应不同：

### 基础材质 (MeshBasicMaterial)

```javascript
// 不受光照影响
const basicMaterial = new THREE.MeshBasicMaterial({
    color: 0xff0000,
});
```

### Lambert 材质 (MeshLambertMaterial)

```javascript
// 漫反射光照模型
const lambertMaterial = new THREE.MeshLambertMaterial({
    color: 0xff0000,
});
```

### Phong 材质 (MeshPhongMaterial)

```javascript
// 支持镜面反射
const phongMaterial = new THREE.MeshPhongMaterial({
    color: 0xff0000,
    shininess: 100,
    specular: 0x1188ff,
});
```

### 标准材质 (MeshStandardMaterial)

```javascript
// 基于物理的渲染 (PBR)
const standardMaterial = new THREE.MeshStandardMaterial({
    color: 0xff0000,
    metalness: 0.3,
    roughness: 0.4,
});
```

## 阴影系统

Three.js 提供了强大的阴影渲染功能：

```javascript
// 启用渲染器阴影
renderer.shadowMap.enabled = true;
renderer.shadowMap.type = THREE.PCFSoftShadowMap;

// 设置对象投射阴影
cube.castShadow = true;

// 设置对象接收阴影
plane.receiveShadow = true;

// 光源投射阴影
directionalLight.castShadow = true;
```

## 完整光照场景示例

```javascript
function createLightingScene() {
    const scene = new THREE.Scene();

    // 环境光 - 提供基础照明
    const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
    scene.add(ambientLight);

    // 主光源 - 模拟太阳
    const mainLight = new THREE.DirectionalLight(0xffffff, 0.8);
    mainLight.position.set(10, 10, 5);
    mainLight.castShadow = true;
    scene.add(mainLight);

    // 补光 - 填充阴影区域
    const fillLight = new THREE.DirectionalLight(0x8888ff, 0.3);
    fillLight.position.set(-10, 5, -5);
    scene.add(fillLight);

    // 装饰光 - 增加视觉效果
    const accentLight = new THREE.PointLight(0xff4444, 0.5, 30);
    accentLight.position.set(5, 3, 5);
    scene.add(accentLight);

    return scene;
}
```

## 光照优化技巧

1. **合理使用光源数量** - 过多光源会影响性能
2. **调整阴影质量** - 根据需求平衡质量和性能
3. **使用光照贴图** - 预计算静态光照
4. **LOD 光照** - 距离相机远的对象使用简化光照

## 小结

Three.js 光照系统包含：

1. **多种光源类型** - 环境光、平行光、点光源、聚光灯
2. **材质响应** - 不同材质的光照计算模型
3. **阴影系统** - 真实感阴影渲染
4. **性能优化** - 光照计算的优化策略

掌握光照系统是创建真实感 3D 场景的关键。
