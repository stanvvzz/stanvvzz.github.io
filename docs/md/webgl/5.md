# 视图矩阵

所有者: Stan

> 构建视图矩阵，需要知道
>
1. 视点，相机位置
2. 目标点
3. 相机上方向

> 流程：
>
1. 平移视点到世界原点，获取 direction
2. direction 和上方向叉乘，通过右手定则获取 right
3. 通过 right 和 direction 获取真正的 up

> 平移矩阵：

$$
\begin{bmatrix}
1 & 0 & 0 & t_x \\
0 & 1 & 0 & t_y \\
0 & 0 & 1 & t_z \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

> 基变换矩阵：

$$
\begin{bmatrix}
\mathrm{right}_x & \mathrm{right}_y & \mathrm{right}_z & 0 \\
\mathrm{cameraUp}_x & \mathrm{cameraUp}_y & \mathrm{cameraUp}_z & 0 \\
\mathrm{direction}_x & \mathrm{direction}_y & \mathrm{direction}_z & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

点积的几何意义：A 向量点积 B 向量，获取 A 在 B 向量上投影的长度。

可以用来将世界坐标转换到相机坐标系：

- 一个点的 **新 X 坐标**，就是它在相机 `right` 方向上的投影。
- 一个点的 **新 Y 坐标**，就是它在相机 `cameraUp` 方向上的投影。
- 一个点的 **新 Z 坐标**，就是它在相机 `direction` 方向上的投影。

基变换矩阵 · 平移矩阵 = 视图矩阵

> 方向向量计算公式：

$$
\begin{aligned}
\mathbf{f} &= \mathrm{normalize}(\mathbf{t} - \mathbf{e}) \quad \text{(forward)} \\
\mathbf{r} &= \mathrm{normalize}(\mathbf{f} \times \mathbf{up}) \quad \text{(right)} \\
\mathbf{u} &= \mathbf{r} \times \mathbf{f} \quad \text{(true up)}
\end{aligned}
$$

> 最终视图矩阵：

$$
\begin{bmatrix}
\mathrm{right}_x & \mathrm{right}_y & \mathrm{right}_z & -\mathbf{r} \cdot \mathbf{e} \\
\mathrm{cameraUp}_x & \mathrm{cameraUp}_y & \mathrm{cameraUp}_z & -\mathbf{u} \cdot \mathbf{e} \\
\mathrm{direction}_x & \mathrm{direction}_y & \mathrm{direction}_z & -\mathbf{f} \cdot \mathbf{e} \\
0 & 0 & 0 & 1
\end{bmatrix}
$$
